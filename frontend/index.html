<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anonymous Wall</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <pre class="ascii-header">
   _____                              _   _       _ _ 
  |  __ \                            | | (_)     (_|_)
  | |  | | __ _ _ __ ___   ___  _ __ | |_ _ _ __  _ _ 
  | |  | |/ _` | '_ ` _ \ / _ \| '_ \| __| | '_ \| | |
  | |__| | (_| | | | | | | (_) | | | | |_| | | | | | |
  |_____/ \__,_|_| |_| |_|\___/|_| |_|\__|_|_| |_| |_|
  </pre
    >
    <div class="typing-intro" id="introText"></div>
    <div class="container">
      <h1>Anonymous Message Wall</h1>
      <form id="messageForm">
        <input type="text" id="nameInput" placeholder="Your name..." required />
        <textarea
          id="messageInput"
          placeholder="Write your message..."
          required
        ></textarea>
        <button type="submit">Post</button>
      </form>
      <div id="messages"></div>
    </div>

    <script>
      // Typing effect
      const introText = "Welcome to the Underground. Leave a mark.";
      let index = 0;
      const typingSpeed = 60;

      function typeIntro() {
        if (index < introText.length) {
          document.getElementById("introText").innerHTML +=
            introText.charAt(index);
          index++;
          setTimeout(typeIntro, typingSpeed);
        }
      }

      typeIntro();

      const form = document.getElementById("messageForm");
      const nameInput = document.getElementById("nameInput");
      const messageInput = document.getElementById("messageInput");
      const messagesDiv = document.getElementById("messages");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = nameInput.value.trim();
        const content = messageInput.value.trim();
        if (!name || !content) return;

        await fetch("/api/messages", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, content }),
        });

        nameInput.value = "";
        messageInput.value = "";
        loadMessages();
      });

      async function loadMessages() {
        const res = await fetch("/api/messages");
        const messages = await res.json();
        messagesDiv.innerHTML = messages
          .map(
            (msg) => `
        <div class="message"><strong>${msg.name}:</strong> ${msg.content}</div>
      `
          )
          .join("");
      }

      loadMessages();
    </script>
  </body>
</html>
